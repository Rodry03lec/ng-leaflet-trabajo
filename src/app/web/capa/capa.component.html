<div class="relative w-full h-screen flex flex-col overflow-hidden">
  <!-- Contenedor del Mapa -->
  <div #mapContainer class="relative h-full z-0 leaflet-container transition-all duration-300"
  [ngStyle]="{'width': panelVisible1 ? 'calc(100% - 24rem)' : '100%'}">
  </div>

  <!-- Logo Flotante con Efectos Avanzados (Optimizado para móviles) -->
  <div class="fixed top-4 left-4 sm:top-12 sm:left-20 z-50 group">
    <!-- Halo de luz alrededor del logo (optimizado) -->
    <div class="absolute inset-0 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full blur-md sm:blur-lg opacity-0 group-hover:opacity-70 transition-all duration-700 scale-0 group-hover:scale-150 -z-10"></div>

    <!-- Partículas flotantes (reducidas en móviles) -->
    <div class="absolute -inset-2 sm:-inset-4 opacity-0 group-hover:opacity-100 transition-opacity duration-700">
      <div class="absolute top-0 left-1/4 w-1 h-1 sm:w-2 sm:h-2 bg-[#F18700] rounded-full animate-ping"></div>
      <div class="absolute bottom-1/4 right-0 w-0.5 h-0.5 sm:w-1 sm:h-1 bg-[#008B9C] rounded-full animate-bounce"></div>
      <div class="absolute bottom-0 left-1/3 w-1 h-1 sm:w-1.5 sm:h-1.5 bg-[#A22582] rounded-full animate-pulse"></div>
      <div class="absolute top-1/4 right-1/4 w-5 h-5 sm:w-3 sm:h-3 bg-[#2A3064] rounded-full animate-ping"></div>
    </div>

    <!-- Logo principal con tamaños responsive -->
    <div class="relative">
      <img
        src="logos/image2vector.svg"
        alt="Logo INE"
        class="w-12 h-12 sm:w-16 sm:h-16 md:w-24 md:h-24 lg:w-32 lg:h-32
              bg-white/95 rounded-full p-2 sm:p-3
              shadow-lg
              backdrop-blur-lg
              transition-all duration-700 ease-in-out
              hover:shadow-xl
              hover:ring-2 sm:hover:ring-4 hover:ring-blue-400/50
              group-hover:scale-110
              group-hover:rotate-[360deg]
              group-hover:brightness-110
              dark:bg-gray-900/90 dark:border dark:border-gray-700"
      />

      <!-- Indicador de estado (más pequeño en móviles) -->
      <div class="absolute -bottom-1 -right-1 sm:-bottom-2 sm:-right-2 w-3 h-3 sm:w-4 sm:h-4 bg-[#2A3064] rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300 animate-pulse shadow-lg shadow-[#2A3064]/50"></div>
    </div>

    <!-- Texto emergente (ajustado) -->
    <div class="absolute -bottom-8 sm:-bottom-10 left-1/2 transform -translate-x-1/2 bg-black/80 text-white px-2 py-0.5 sm:px-3 sm:py-1 rounded-full text-xs sm:text-sm whitespace-nowrap opacity-0 group-hover:opacity-100 transition-all duration-500 group-hover:-translate-y-2">
      INE
    </div>
  </div>

  <!-- Menú Flotante (visible en pantallas grandes, oculto en móviles) -->
  <nav class="fixed  top-20 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 flex space-x-4 bg-white/80 backdrop-blur-sm rounded-xl shadow-lg p-2 md:block hidden">
    <button *ngFor="let btn of ['Video', 'Mapas', 'Presentación']"
      class="px-4 py-2 text-sm font-medium text-2xl hover:text-white hover:bg-[#2A3064] rounded-lg transition">
      {{ btn }}
    </button>
  </nav>




  <!-- Panel lateral (fuera del mapa para evitar ocultarlo) -->
  <div class="absolute right-0 top-0 h-full bg-white shadow-lg w-96 p-4 transition-transform duration-300
  sm:w-96 md:w-96 lg:w-96 xl:w-96"
  [ngClass]="panelVisible1 ? 'translate-x-0' : 'translate-x-full'" style="z-index: 10;">

    <!-- Contenido del Panel -->
    <div class="card">
      <h2 class="text-lg font-bold text-center mb-2">Datos o Detalles</h2>
      <p>
        Lorem ipsum dolor sit amet consectetur adipisicing elit. Tempora quas pariatur corporis. Iure eius odit temporibus unde hic necessitatibus obcaecati odio a aperiam quasi quisquam, aliquid sapiente distinctio tempore enim?
      </p>
    </div>

    <div class="card">
      <h2 class="text-lg font-bold text-center mb-2">Grafica</h2>
      <p-chart type="bar" [data]="datosCard" [options]="optionesCard" class="h-[96rem] w-32" />
    </div>

    <div>
      <p-button icon="pi pi-times" severity="danger" />
    </div>


    <!-- Botón de alternar el panel (dentro del panel) -->
    <button (click)="panelVisible1 = !panelVisible1"
      class="absolute top-0 left-[-55px] w-16 h-16 flex items-center justify-center text-white shadow-xl
      transition-all duration-300 ease-in-out"
      [ngClass]="panelVisible1 ? 'bg-red-500' : 'bg-[#2A3064]'">
      <i class="pi text-2xl" [ngClass]="panelVisible1 ? 'pi-times' : 'pi-bars'"></i>
    </button>
  </div>




  <!-- Toggle Panel Button -->
  <button (click)="alternarPanel()"
    class="fixed bottom-6 left-6 z-50 w-16 h-16 flex items-center justify-center text-white rounded-full shadow-xl transition-all duration-300 ease-in-out overflow-hidden group"
    [ngClass]="{
      'bg-red-500': panelVisible,
      'bg-[#2A3064]  from-blue-500 to-indigo-700': !panelVisible
    }">

    <!-- Icono con transición suave -->
    <i class="pi text-2xl transition-transform duration-300 relative z-10" [ngClass]="{
      'pi-times transform rotate-90': panelVisible,
      'pi-bars': !panelVisible
    }"></i>

    <!-- Overlay de efecto al hacer hover -->
    <span class="absolute inset-0 bg-white opacity-0 group-hover:opacity-20 transition-opacity duration-300"></span>
  </button>

  <!-- Bottom Panel -->
  <section *ngIf="panelVisible" class="absolute bottom-32 left-4 z-10 flex flex-col md:flex-row backdrop-blur-sm rounded-xl shadow-2xl transition duration-500">
    <!-- Sidebar -->
    <aside class="bg-[#2A3064] text-center text-white w-full md:w-20 flex flex-row md:flex-col p-2 space-x-2 md:space-x-0 md:space-y-4">
      @for (listar of menuElementos; track $index) {
        <div class="p-4 rounded-lg shadow-md bg-[#41477A] cursor-pointer" pTooltip="{{ listar.nombreMenu }}"
          tooltipPosition="right" (click)="evento(listar)">
          <i class="pi {{ listar.icon }}"></i>
        </div>
      }
    </aside>

    <!-- Content Section -->
    <p-scrollpanel class="w-full md:w-96 h-[20vh] md:h-[50vh] bg-white rounded-lg shadow-lg h-50vh overflow-y-auto">

      <main class="flex-grow p-4 max-w-[50vh]">
        <ng-container *ngIf="elementoSeleccionado; else noSelection">
          <!-- Header -->
          <header class="bg-[#2A3064] flex items-center mb-6 text-white font-bold p-4 rounded-lg">
            <div class="bg-white/20 p-3 rounded-full mr-4" >
              <i class="pi {{ elementoSeleccionado.icon }} text-2xl"></i>
            </div>
            <div>
              <h3 class="text-white text-xl">{{ elementoSeleccionado.nombreMenu }}</h3>
            </div>
          </header>

          <!-- Details Section with Scroll -->
          <div class=" rounded-lg">
            <div class="p-2 md:p-2">
              <div *ngIf="elementoSeleccionado.icon === 'pi-map'">
                <p-dataview [value]="capasGeoJSONalmacenadas">
                    <ng-template #list let-items>
                      @for (item of items; track $index) {
                        <div class="col-span-12" class="col-span-12">
                          <div class="flex flex-col sm:flex-row sm:items-center p-6 gap-4">
                            <!-- Content Section -->
                            <div class="flex flex-col md:flex-row justify-between md:items-center flex-1 gap-6">
                              <div class="flex flex-row md:flex-col justify-between items-start gap-2">
                                <div>
                                  <div class="text-lg font-medium text-surface-900 dark:text-surface-0 mt-2">{{ item.titulo }}</div>
                                </div>
                              </div>
                              <div class="flex flex-col md:items-end gap-8">
                                <div class="flex flex-row-reverse md:flex-row gap-2">
                                  <p-button icon="pi pi-trash" severity="danger" (click)="eliminarCapa(item.nombre)" />
                                </div>
                              </div>
                            </div>
                          </div>
                          <p-slider [(ngModel)]="valorColor" [min]="0" [max]="0.7" [step]="0.01" (onChange)="cambiarOpacidad(item.nombre, $event)" />

                        </div>
                      }
                    </ng-template>
                </p-dataview>
              </div>

              <div *ngIf="elementoSeleccionado.icon !== 'pi-map'">
                <p-accordion>
                  <!-- Primer nivel: "Vivienda", "CNA 2013", etc. -->
                  <p-accordion-panel *ngFor="let item of indice" [value]="item.tema">
                    <p-accordion-header>
                      <div class="text-icon-container">
                        <span class="text">{{ item.tema }}</span>
                        <i class="icono" [class]="item.icono ? item.icono : ''"></i>
                      </div>
                    </p-accordion-header>

                    <p-accordion-content>
                      <!-- Segundo nivel: Secciones (Acceso a bienes, Condiciones habitacionales) -->
                      <ng-container *ngIf="item.datos && item.datos.length > 0; else loggedOut1">
                        <p-accordion *ngIf="item.datos.length">
                          <p-accordion-panel *ngFor="let item1 of item.datos" [value]="item1.seccion || 'Sin Sección'">
                            <p-accordion-header>
                              <div class="text-icon-container">
                                <span class="text">{{ item1.seccion || item1.titulo || 'Sin Título' }}</span>
                              </div>
                            </p-accordion-header>
                            <p-accordion-content>
                              <!-- Tercer nivel: subsecciones (si existen) -->
                              <ng-container *ngIf="item1.datos?.length > 0; else noSubsections">
                                <p-accordion *ngIf="item1.datos.length">
                                  <p-accordion-panel *ngFor="let item2 of item1.datos" [value]="item2.subseccion || item2.titulo">
                                    <p-accordion-header>
                                      <div class="text-icon-container">
                                        <span class="text">{{ item2.subseccion || item2.titulo }}</span>
                                        <i class="icono" [class]="item2.icono || ''"></i>
                                      </div>
                                    </p-accordion-header>
                                    <p-accordion-content>
                                      <!-- Cuarto nivel: datos dentro de las subsecciones -->
                                      <ng-container *ngIf="item2.datos?.length > 0; else showButton">
                                        <div *ngFor="let item3 of item2.datos">
                                          <p-panel [toggleable]="true" [collapsed]="true">
                                            <ng-template pTemplate="header">
                                              {{ item3.titulo }}
                                            </ng-template>
                                            <div class="boton-container">
                                              <p-button type="button" label="{{ botonMapa }}" (click)="opcion(item3)" severity="contrast" ></p-button>
                                            </div>
                                          </p-panel>
                                        </div>
                                      </ng-container>
                                      <ng-template #showButton>
                                        <div class="boton-container">
                                          <p-button type="button" label="{{ botonMapa }}" (click)="opcion(item2)" severity="contrast"></p-button>
                                        </div>
                                      </ng-template>
                                    </p-accordion-content>
                                  </p-accordion-panel>
                                </p-accordion>
                              </ng-container>
                              <ng-template #noSubsections>
                                <!-- Mostrar el botón si no hay subsecciones -->
                                <div class="boton-container">
                                  <p-button type="button" label="{{ botonMapa }}" (click)="opcion(item1)" severity="contrast" ></p-button>
                                </div>
                              </ng-template>
                            </p-accordion-content>
                          </p-accordion-panel>
                        </p-accordion>
                      </ng-container>

                      <!-- Si no hay datos en el segundo nivel, mostramos las tarjetas -->
                      <ng-template #loggedOut1>
                        <div *ngFor="let item1 of item.datos">
                          <p-card (click)="opcion(item1)">
                            <p class="m-0">{{ item1.titulo || 'Sin Título' }}</p>
                            <div class="boton-container">
                              <p-button type="button" label="Agregar Capa" (click)="opcion(item1)" severity="contrast" ></p-button>
                            </div>
                          </p-card>
                        </div>
                      </ng-template>
                    </p-accordion-content>
                  </p-accordion-panel>
                </p-accordion>
              </div>

            </div>
          </div>

        </ng-container>

        <!-- No Selection Message -->
        <ng-template #noSelection>
          <div class="text-center text-gray-500 p-6">
            <i class="pi pi-info-circle text-4xl mb-4 text-blue-500"></i>
            <p>Selecciona una categoría para explorar más detalles</p>
          </div>
        </ng-template>
      </main>
    </p-scrollpanel>
  </section>

</div>
